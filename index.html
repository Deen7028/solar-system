<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบสุริยะ 3D (Beautiful Solar System)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050508; font-family: 'Sarabun', sans-serif; }
        
        /* กำหนด Canvas ให้เต็มจออย่างชัดเจน */
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: 1;
        }

        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            color: rgba(255, 255, 255, 0.9);
            pointer-events: none;
            user-select: none;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            z-index: 10;
        }
        h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 300;
            letter-spacing: 2px;
            color: #fff;
        }
        p {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #aaa;
        }

        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            display: none;
            pointer-events: none;
            white-space: nowrap;
            font-weight: 300;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px);
            z-index: 20;
        }

        .controls-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            pointer-events: none;
            background: rgba(0,0,0,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            z-index: 10;
        }
        .key { color: #ffd700; font-weight: bold; }
        
        #error-msg {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff5555;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ff5555;
            z-index: 30;
        }
    </style>
</head>
<body>

    <!-- สร้าง Canvas ไว้ใน HTML โดยตรง เพื่อความเสถียร -->
    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <h1>SOLAR SYSTEM 3D</h1>
        <p>ระบบสุริยะจำลอง</p>
    </div>

    <div id="tooltip"></div>
    <div id="error-msg"></div>
    <div class="controls-hint">
        <span class="key">คลิกซ้าย:</span> หมุน | 
        <span class="key">คลิกขวา:</span> ย้าย | 
        <span class="key">ลูกกลิ้ง:</span> ซูม
    </div>

    <!-- Import Map สำหรับโหลด Three.js -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
                "three/examples/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';

        // ตัวแปรหลัก
        let scene, camera, renderer, controls;
        let planets = [];
        let raycaster, mouse;
        let starUniforms; 
        const tooltip = document.getElementById('tooltip');

        // ข้อมูลดาวเคราะห์
        const planetData = [
            { name: "Mercury (ดาวพุธ)", color: 0xA5A5A5, size: 1.2, distance: 20, speed: 0.04 },
            { name: "Venus (ดาวศุกร์)", color: 0xE3BB76, size: 2.0, distance: 28, speed: 0.025 },
            { name: "Earth (โลก)", color: 0x2E8B57, size: 2.2, distance: 38, speed: 0.02 },
            { name: "Mars (ดาวอังคาร)", color: 0xE27B58, size: 1.5, distance: 48, speed: 0.016 },
            { name: "Jupiter (ดาวพฤหัส)", color: 0xD6A566, size: 5.5, distance: 70, speed: 0.008 },
            { name: "Saturn (ดาวเสาร์)", color: 0xF4D03F, size: 4.5, distance: 95, speed: 0.006, hasRing: true },
            { name: "Uranus (ดาวยูเรนัส)", color: 0x7DE3F4, size: 3.0, distance: 120, speed: 0.004 },
            { name: "Neptune (ดาวเนปจูน)", color: 0x3E54E8, size: 2.8, distance: 140, speed: 0.003 }
        ];

        function init() {
            // 1. สร้าง Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050508); 
            scene.fog = new THREE.FogExp2(0x050508, 0.002);

            // 2. กล้อง
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 60, 80);

            // 3. Renderer (ปรับปรุงใหม่: ใช้ Canvas ที่มีอยู่แล้ว)
            const canvasElement = document.getElementById('gameCanvas');
            
            try {
                // พยายามสร้าง WebGL Context โดยใช้ Canvas ที่เตรียมไว้
                renderer = new THREE.WebGLRenderer({ 
                    canvas: canvasElement, 
                    antialias: true,
                    alpha: false 
                });
            } catch (e) {
                console.warn("High-quality WebGL failed, retrying simple mode...", e);
                try {
                    // Fallback: ปิด Antialias และใช้ค่า Default
                    renderer = new THREE.WebGLRenderer({ 
                        canvas: canvasElement, 
                        antialias: false,
                        alpha: false 
                    });
                } catch (e2) {
                    console.error("WebGL failed completely.", e2);
                    const errorDiv = document.getElementById('error-msg');
                    errorDiv.style.display = 'block';
                    errorDiv.innerHTML = '<h2>ขออภัย ไม่สามารถแสดงผล 3D ได้</h2><p>Graphics Driver ของท่านอาจไม่รองรับ WebGL</p>';
                    return; // หยุดทำงานถ้าสร้าง Renderer ไม่ได้
                }
            }
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // จำกัด Pixel Ratio เพื่อประสิทธิภาพ

            // 4. Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; 
            controls.dampingFactor = 0.05;
            
            // ปลดล็อกการซูม เพื่อให้เข้าไปในดวงอาทิตย์ได้ (รัศมีดวงอาทิตย์คือ 8)
            controls.minDistance = 1; 
            controls.maxDistance = 400;

            // 5. Lighting
            const sunLight = new THREE.PointLight(0xffaa00, 2, 300);
            scene.add(sunLight);
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4); 
            scene.add(ambientLight);

            // 6. ดวงอาทิตย์
            createSun();

            // 7. ดาวเคราะห์
            planetData.forEach(data => {
                const planetObj = createPlanet(data);
                planets.push(planetObj);
                scene.add(planetObj.meshObj);
                scene.add(planetObj.orbitLine);
            });

            // 8. ดาวพื้นหลัง (Shader)
            createStars();

            // 9. Raycaster
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);

            animate();
        }

        function createSun() {
            const sunGeometry = new THREE.SphereGeometry(8, 32, 32); 
            const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xFFD700 });
            const sun = new THREE.Mesh(sunGeometry, sunMaterial);
            
            // Glow (Simple transparent mesh)
            const sunGlow = new THREE.Mesh(
                new THREE.SphereGeometry(9.5, 32, 32),
                new THREE.MeshBasicMaterial({ color: 0xFF8C00, transparent: true, opacity: 0.35, side: THREE.BackSide })
            );
            sun.add(sunGlow);

            const sunOuterGlow = new THREE.Mesh(
                new THREE.SphereGeometry(12, 32, 32),
                new THREE.MeshBasicMaterial({ color: 0xFF4500, transparent: true, opacity: 0.15, side: THREE.BackSide })
            );
            sun.add(sunOuterGlow);

            // --- เพิ่มชื่อ "Salwanee Baraheng" ---
            const textCanvas = document.createElement('canvas');
            const textCtx = textCanvas.getContext('2d');
            // เพิ่มความละเอียด Canvas เพื่อให้ตัวหนังสือคมชัด
            textCanvas.width = 512;
            textCanvas.height = 128;
            textCtx.font = 'bold 50px Sarabun, sans-serif'; // ฟอนต์ใหญ่ขึ้น
            textCtx.fillStyle = '#FFFFFF'; // สีขาว
            textCtx.textAlign = 'center';
            textCtx.textBaseline = 'middle';
            textCtx.fillText('Salwanee Baraheng', textCanvas.width / 2, textCanvas.height / 2);

            const textTexture = new THREE.CanvasTexture(textCanvas);
            const textMaterial = new THREE.SpriteMaterial({ 
                map: textTexture,
                transparent: true,
                opacity: 0.9
            });
            const textSprite = new THREE.Sprite(textMaterial);
            
            // ปรับขนาด Scale ใน 3D World (เล็กๆ)
            // เมื่อซูมเข้าไปใกล้ๆ Resolution ของ Texture จะทำงานให้ชัดเอง
            textSprite.scale.set(4, 1, 1); 
            textSprite.position.set(0, 0, 0); // วางไว้ใจกลาง
            
            sun.add(textSprite);
            // ------------------------------------

            sun.userData = { name: "Sun (ดวงอาทิตย์)" };
            scene.add(sun);
        }

        function createPlanet(data) {
            const orbitCurve = new THREE.EllipseCurve(0, 0, data.distance, data.distance, 0, 2 * Math.PI, false, 0);
            const points = orbitCurve.getPoints(100); 
            const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points);
            const orbitMaterial = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.15 });
            const orbitLine = new THREE.LineLoop(orbitGeometry, orbitMaterial);
            orbitLine.rotation.x = -Math.PI / 2;

            const geometry = new THREE.SphereGeometry(data.size, 32, 32);
            const material = new THREE.MeshStandardMaterial({ 
                color: data.color, 
                roughness: 0.6, 
                metalness: 0.2 
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.userData = { name: data.name };

            if (data.hasRing) {
                const ringGeo = new THREE.RingGeometry(data.size * 1.4, data.size * 2.2, 64);
                const ringMat = new THREE.MeshBasicMaterial({ color: 0xDDCCAA, side: THREE.DoubleSide, transparent: true, opacity: 0.6 });
                const ring = new THREE.Mesh(ringGeo, ringMat);
                ring.rotation.x = Math.PI / 2;
                mesh.add(ring);
            }

            const pivot = new THREE.Object3D();
            pivot.add(mesh);
            mesh.position.set(data.distance, 0, 0);

            return {
                meshObj: pivot,
                planetMesh: mesh,
                distance: data.distance,
                speed: data.speed,
                angle: Math.random() * Math.PI * 2,
                orbitLine: orbitLine
            };
        }

        function createStars() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsCount = 3000; 
            const posArray = new Float32Array(starsCount * 3);
            const scaleArray = new Float32Array(starsCount);

            for(let i = 0; i < starsCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 1500; 
            }
            for(let i = 0; i < starsCount; i++) {
                scaleArray[i] = Math.random(); 
            }

            starsGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            starsGeometry.setAttribute('aScale', new THREE.BufferAttribute(scaleArray, 1));
            
            starUniforms = {
                uTime: { value: 0 },
                color: { value: new THREE.Color(0xffffff) }
            };

            const starMaterial = new THREE.ShaderMaterial({
                uniforms: starUniforms,
                vertexShader: `
                    attribute float aScale;
                    uniform float uTime;
                    void main() {
                        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
                        float time = uTime * 2.0; 
                        float blink = sin(time + aScale * 100.0);
                        float size = aScale * 3.0 + blink * 0.8; 
                        size = max(0.8, size); 
                        gl_PointSize = size * ( 200.0 / -mvPosition.z );
                        gl_Position = projectionMatrix * mvPosition;
                    }
                `,
                fragmentShader: `
                    uniform vec3 color;
                    void main() {
                        float d = distance(gl_PointCoord, vec2(0.5));
                        if(d > 0.5) discard;
                        float intensity = 1.0 - (d * 2.0);
                        intensity = pow(intensity, 1.5);
                        gl_FragColor = vec4( color, intensity );
                    }
                `,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });
            
            const starMesh = new THREE.Points(starsGeometry, starMaterial);
            scene.add(starMesh);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            tooltip.style.left = event.clientX + 15 + 'px';
            tooltip.style.top = event.clientY + 15 + 'px';
        }

        function checkIntersection() {
            raycaster.setFromCamera(mouse, camera);
            const planetMeshes = planets.map(p => p.planetMesh);
            const sun = scene.children.find(c => c.userData.name === "Sun (ดวงอาทิตย์)");
            if(sun) planetMeshes.push(sun);

            const intersects = raycaster.intersectObjects(planetMeshes);

            if (intersects.length > 0) {
                const object = intersects[0].object;
                tooltip.style.display = 'block';
                tooltip.innerHTML = object.userData.name;
                document.body.style.cursor = 'pointer';
                if(object.material.emissive) object.material.emissive.setHex(0x333333);
            } else {
                tooltip.style.display = 'none';
                document.body.style.cursor = 'default';
                planetMeshes.forEach(mesh => {
                     if(mesh.material.emissive) mesh.material.emissive.setHex(0x000000);
                });
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            if(starUniforms) starUniforms.uTime.value += 0.02;
            planets.forEach(p => {
                p.angle += p.speed * 0.5; 
                p.planetMesh.position.x = Math.cos(p.angle) * p.distance;
                p.planetMesh.position.z = Math.sin(p.angle) * p.distance;
                p.planetMesh.rotation.y += 0.01;
            });
            const sun = scene.children.find(c => c.userData.name === "Sun (ดวงอาทิตย์)");
            if(sun) sun.rotation.y += 0.002;

            controls.update();
            checkIntersection();
            renderer.render(scene, camera);
        }

        window.onload = init;

    </script>
</body>
</html>